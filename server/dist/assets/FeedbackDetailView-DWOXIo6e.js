import{_ as M,y as U,v as m,x as H,O as y,A as t,aV as q,B as f,c as a,C as s,D as k,E as n,aR as J,aQ as i,z as h,K,J as O,H as P,L as Q}from"./index-xlKwCHsv.js";import{c as G,b as x,d as u,e as B,V as W,h as F,s as X,S as Y}from"./VInput-C5y_bQnC.js";import{V as Z,f as V,g as v,e as T}from"./VRow-DDlsIFtk.js";import{a as ee,V as te}from"./VTextarea-CNlSBO0q.js";const ae=G("v-spacer","div","VSpacer"),le="/send.svg",se={class:"d-flex align-center mb-6"},oe={class:"text-h6 mt-4"},re={class:"d-flex justify-space-between align-center w-100"},ne={class:"d-flex align-center"},de={class:"text-h5"},ie={class:"text-caption"},ue={class:"mb-6"},ce={class:"d-flex justify-space-between"},me={class:"text-body-1 pa-1 bg-grey-lighten-4"},fe={class:"text-body-1"},ve={class:"text-body-1 font-mono"},pe={style:{display:"flex","justify-content":"space-between"}},ge={class:"d-flex align-center mb-2"},be={__name:"FeedbackDetailView",props:{id:String},setup(A){const w=A,d=U({show:!1,text:"",color:"green"}),C=(l,e)=>{d.text=l,d.color=e,d.show=!0},r=m(null),_=m(!0),p=m(null),g=m(!1),c=m(""),b=m(null),D=q(),N=Q();H(async()=>{await S(),R()});function R(){b.value&&b.value.scrollTo({top:b.value.scrollHeight,behavior:"smooth"})}const $=async l=>{try{console.log("回复",c);const e=await x.submitFeedback({name:l,message:{role:"admin",msg:c.value}});console.log("reply-response",e),c.value="",C("回复成功！","green"),S()}catch(e){p.value="回复反馈时出错",C("回复失败！","red"),console.error("Error reply feedback:",e)}},S=async()=>{try{const l=w.id||D.params.id,e=await x.fetchFeedback(l);e?(r.value=e,console.log("回显",r.value),r.value.isReply&&(c.value=r.value.reply)):p.value="反馈未找到"}catch(l){p.value="加载反馈时出错",console.error("Error fetching feedback:",l)}finally{_.value=!1}},E=[l=>!!l||"Message is required",l=>l&&l.length>=10||"Message must contain at least 10 characters",l=>l&&l.length<=500||"Message must contain less than 500 characters"],I=l=>new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),j=l=>new Date(l).toLocaleDateString("zh-CN",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=()=>{g.value=!0},L=async()=>{try{const l=w.id||D.params.id;await x.deleteFeedback(l),N.replace({name:"Admin"})}catch(l){l.value="删除反馈时出错",console.error("Error deleting feedback:",l)}g.value=!1};return(l,e)=>(f(),y(Z,{class:"py-6"},{default:t(()=>[a(T,{justify:"center"},{default:t(()=>[a(V,{cols:"12",md:"8",lg:"6"},{default:t(()=>[s("div",se,[a(v,{icon:"",variant:"text",onClick:e[0]||(e[0]=o=>l.$router.go(-1)),class:"me-2"},{default:t(()=>[a(k,null,{default:t(()=>e[7]||(e[7]=[n("mdi-arrow-left")])),_:1})]),_:1}),e[8]||(e[8]=s("h1",{class:"text-h4 font-weight-bold"},"反馈详情",-1))]),_.value?(f(),y(u,{key:0,class:"text-center pa-8"},{default:t(()=>[a(J,{indeterminate:"",color:"primary"}),e[9]||(e[9]=s("div",{class:"mt-4"},"正在加载反馈详情...",-1))]),_:1})):p.value?(f(),y(u,{key:1,class:"text-center pa-8",color:"error-lighten-5"},{default:t(()=>[a(k,{size:"64",color:"error"},{default:t(()=>e[10]||(e[10]=[n("mdi-alert-circle")])),_:1}),s("div",oe,i(p.value),1),a(v,{color:"primary",class:"mt-4",onClick:e[1]||(e[1]=o=>l.$router.push({name:"Admin"}))},{default:t(()=>e[11]||(e[11]=[n(" 返回反馈列表 ")])),_:1})]),_:1})):r.value?(f(),y(u,{key:2,class:"elevation-4"},{default:t(()=>[a(B,{class:"pa-6 bg-primary text-white"},{default:t(()=>[s("div",re,[s("div",ne,[a(W,{color:"white",class:"me-3"},{default:t(()=>[a(k,{color:"primary"},{default:t(()=>e[12]||(e[12]=[n("mdi-account")])),_:1})]),_:1}),s("div",null,[s("div",de,i(r.value.name),1),s("div",ie,i(I(r.value.createdAt)),1)])]),e[13]||(e[13]=s("div",null,null,-1))])]),_:1}),a(F,{class:"pa-6"},{default:t(()=>[s("div",ue,[s("div",ce,[e[16]||(e[16]=s("h3",{class:"text-h6 mb-3"},"反馈内容：",-1)),a(v,{color:"error",variant:"outlined",onClick:z},{default:t(()=>[a(k,{start:""},{default:t(()=>e[14]||(e[14]=[n("mdi-delete")])),_:1}),e[15]||(e[15]=n(" 删除反馈 "))]),_:1})]),s("div",{style:{"max-height":"28vh","overflow-y":"auto"},ref_key:"feedbackContainer",ref:b},[(f(!0),h(O,null,K(r.value.message,o=>(f(),h("div",me,i(o.role+":  "+o.msg),1))),256))],512)]),a(T,null,{default:t(()=>[a(V,{cols:"12",md:"6"},{default:t(()=>[a(u,{variant:"outlined",class:"pa-4"},{default:t(()=>[e[17]||(e[17]=s("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"}," 创建日期 ",-1)),s("div",fe,i(j(r.value.createdAt)),1)]),_:1})]),_:1}),a(V,{cols:"12",md:"6"},{default:t(()=>[a(u,{variant:"outlined",class:"pa-4"},{default:t(()=>[e[18]||(e[18]=s("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"}," 反馈ID ",-1)),s("div",ve,i(r.value._id),1)]),_:1})]),_:1})]),_:1}),a(u,{variant:"outlined",class:"mt-4 pa-4"},{default:t(()=>[s("div",pe,[e[21]||(e[21]=s("h4",{class:"text-h6 mb-3"},"回复",-1)),a(v,{onClick:e[2]||(e[2]=o=>$(r.value.name))},{append:t(()=>e[19]||(e[19]=[s("img",{src:le,alt:""},null,-1)])),default:t(()=>[e[20]||(e[20]=n(" 提交 "))]),_:1})]),s("div",ge,[a(ee,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),rules:E,"row-height":"15",rows:"3"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})):P("",!0)]),_:1})]),_:1}),a(te,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),"max-width":"400"},{default:t(()=>[a(u,null,{default:t(()=>[a(B,null,{default:t(()=>e[22]||(e[22]=[n("确认删除")])),_:1}),a(F,null,{default:t(()=>{var o;return[n(" 您确定要删除 "+i((o=r.value)==null?void 0:o.name)+" 的反馈吗？此操作无法撤销。 ",1)]}),_:1}),a(X,null,{default:t(()=>[a(ae),a(v,{variant:"text",onClick:e[4]||(e[4]=o=>g.value=!1)},{default:t(()=>e[23]||(e[23]=[n("取消")])),_:1}),a(v,{color:"error",onClick:L},{default:t(()=>e[24]||(e[24]=[n("删除")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:d.show,"onUpdate:modelValue":e[6]||(e[6]=o=>d.show=o),snacbarText:d.text,snackbarColorBt:d.color},null,8,["modelValue","snacbarText","snackbarColorBt"])]),_:1}))}},we=M(be,[["__scopeId","data-v-9b63dbc5"]]);export{we as default};
